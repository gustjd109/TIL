# WEEK08 DAY TIL
- 오늘의 학습 목록
```
1. PintOS GitBook 읽기(Synchronization, Alarm Clock, Priority Scheduling, pintos run alarm-multiple 실행 방법)
2. 카이스트 핀토스 강의 PROJECT1 슬라이드/유튜브 학습
3. PintOS Alarm clock 구현
```

## 1. PintOS GitBook 학습 & 카이스트 핀토스 강의 PROJECT1 슬라이드/유튜브 학습
학습 내용은 깃허브 TIL 리포지토리의 PintOS 디렉터리에 자세하게 정리하여 정리해 놨습니다.

## 2. PintOS Alarm clock 구현
팀원 모두 GitBook과 카이스트 핀토스 강의를 보면서 전체인 흐름과 우리가 구현해야 할 부분이 어디인지 파악했다.  
PintOS를 개발하는데 시간을 많이 투자하기 위해 이론 학습은 이 정도로 마치고 바로 구현에 들어갔다.
남은 이론 또는 모르는 부분은 시간 있을 때 각자 알아서 학습하는 것으로 했다.

대략적인 alarm clock의 구현 목표는 busy waiting으로 구현된 timer_sleep()을 sleep queue를 이용하여 재구현하는 것이다.  
sleep queue로 alarm clock을 구현하기 위해서는 먼저 timer_sleep() 함수 내에 while 문을 if 문으로 바꿔주어야 한다.  
다음으로 thread_sleep() 함수를 새로 만들어 자는 스레드를 깰 시간까지 ready_list가 아닌, sleep_list에 넣어 ticks에 도달하지 않은 스레드가 깨는 일이 없게 만드는 것이다.  
이때, sleep_list는 연결 리스트로 선언하고, 초기화시켜 줘야 한다.  
마지막으로, 자고있는 스레드 중에서 ticks에 도달하거나 지난 스레드를 깨우기 위해 timer_interrupt() 함수에 wakeup() 함수를 추가하고, wakeup() 함수를 구현해야 한다.

다른 부분은 구현하는데 어렵지 않았지만, wakeup() 함수를 구현하면서 트러블 슈팅이 있었다.  
wakeup() 함수에서 ticks에 도달한 스레드를 뽑아서 꺠워야 하는데, 이 스레드를 어떻게 구별해서 뽑아낼 것인가에 대한 방법이 정확하게 떠오르지 않았다.  
처음 시도한 방법은 sleep list에 있는 스레드를 탐색하기 위해 cur_idx 변수를 선언 및 0을 초기화하여, while 문으로 sleep list를 탐색하는 것이었다.  
하지만, 이 방법은 배열 방식으로 접근했기 때문에 연결리스트에서는 인덱스로 정확하게 깨워야 할 스레드를 찾는 게 힘들었다.  
그래서, 리스트에서 얼마만큼의 값을 빼주고 정확하게 스레드의 주소값을 반환해 주는 함수를 이용하여 특정 스레드를 뽑아내는 방법을 이용했다.

위 이슈 외에도 다음과 같이 구현하다 보니 중간에 하나씩 처리해 줘야 하는 부분들이 발견되어 수정 및 추가해 줬다.
- ready_list에 있는 스레드를 재우기 위해 sleep_list로 넣을 때 스레드 동작 상태를 running에서 blocked로 바꿔주는 작업을 두 번 해줬다.
    - 한 번 해주는 것으로 변경하여 해결
- 깨워야 할 스레드를 sleep_list에서 탐색할 때, sleep_list가 비어 있을 경우를 생각하고 구현하지 않았다.
    - 조건을 새로 추가하여 해결
- 재워야할 스레드를 ready_list에서 sleep_list로 옮길 때, ready_list에서 해당 스레드를 뺴준 다음 sleep_list에 넣어줘야 하는데 빼주는 작업을 하지 않고 넣어주기만 했다.
    - 리스트에서 스레드를 빼는 함수를 이용하여 해결
    - sleep_list에서 깨워야할 스레드를 ready_list로 옮길 때도 동일하게 해줘야 한다.  

위와 같이 간단한 오류들은 프로그램을 실행시켰을 때, ASSERT가 발생하는 부분을 확인하고, 왜 해당 ASSERT가 발생했는지 ASSERT를 발생시켜주는 함수를 분석하다보면 하나씩 해결해 나가면 될 것 같다.

## 3. 8주차 1일차를 마치며...
핀토스 과제를 진행하면서 처음에는 정말 뭐부터 시작해야 할지 몰라 막막했지만, 다행히 카이스트 핀토스 강의를 보면서 어떤 방식으로 문제를 해결해야 할지 알게 되었다.  
우리 팀은 한 팀원이 개발하다가 막히는 부분이 있을 때, 다른 팀원이 할 수 있는 부분이라면 자연스럽게 해당 팀원이 구현하고 설명해 주는 방식으로 개발을 진행했다.  
잘 모르겠지만, 이게 페어프로그래밍인가요?...😲  
아무튼 같은 팀원과 협업하면서 개발을 진행하고, 서로 모르는 부분을 설명해 주는 과정을 통해 내가 이해했다고 생각했던 부분 중에서 틀린 부분을 찾아 수정하여 확실하게 이해할 기회가 되어 좋았다.  

핀토스를 거대한 벽이라고 하던데, 대면하고 보니 진짜 어마어마한 벽이다... 근데 프로젝트가 4개니까 벽도 4개...?!🪨🪨🪨🪨  
우리 팀은 벽이고 뭐고 우리 머리가 깨지는지 벽이 깨지는지 그냥 들이받기로 했다. 다행히 첫 번째 벽에 금이 가기 시작한 것 같다.  

오늘 완벽하게 구현하지는 못했지만, idle ticks 수가 결과에 나와있는 수와 똑같이 나왔다. 내일은 kenel ticks의 개수를 올려주고, 다른 부분에서 발생한 ASSERT를 해결하여 alarm clock을 완벽하게 구현할 계획이다.