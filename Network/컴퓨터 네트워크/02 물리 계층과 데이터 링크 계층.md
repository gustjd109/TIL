# 02 물리 계층과 데이터 링크 계층

## 1. 이더넷(Ethernet)
1. 이더넷이란
    - 다양한 통신 매체의 규격들, 송수신되는 프레임의 형태와 프레임을 주고받는 방법 등을 정의한 네트워크 기술
    - 유선 LAN 환경에서 가장 대중적으로 사용되는 기술<br><br>

## 2. 이더넷 표준
1. IEEE 802.3
    - 전기전자공학자협회(IEEE, Institute of Electrical and Electronics Engineers)라는 국제 조직이 이더넷 관련 기술을 표준화한 이름
    - 이더넷 관련 표준 규격들의 집합으로, 이더넷 표준에 따라 지원되는 통신 매체의 종류와 전송 속도가 달라질 수 있음<br><br>

## 3. 통신 매체 표기 형태
1. 기본 표기 형식
    - 전송 속도BASE-추가 특성<br><br>

2. 표기 형식 속성
    - 전송 속도(data rate)
        - 숫자만 표기되어 있으면 Mbps 속도, 숫자 뒤에 G가 붙는 경우 Gbps 속도
    - BASE(BASEband)
        - 비트 신호로 변환된 데이터를 통신 매체로 전송하는 방법인 변조 타입(modulation type)
    - 추가 특성(additional distinction)
        - 통신 매체의 특성을 명시
        - 전송 가능한 최대 거리, 데이터가 비트 신호로 변환되는 방식인 물리 계층 인코딩 방식, 비트 신호를 옮길 수 있는 전송로 수인 레인 수가 명시<br><br>

## 4. 통신 매체의 종류
1. 추가 특성 표기
    - C : 동축 케이블
    - T : 트위스티드 페어 케이블
    - S : 단파장 광섬유 케이블
    - L : 장파장 광섬유 케이블<br><br>

2. 통신 매체 표기 형식 예
    - 10BASE-T 케이블 : 10Mbps 속도를 지원하는 트위스트드 페어 케이블
    - 100BASE-SX 케이블 : 100Mbps 속도를 지원하는 단파장 광섬유 케이블
    - 1000BASE-LX 케이블 : 1000Mbps 속도를 지원하는 장파장 광섬유 케이블<br><br>

## 5. 이더넷 프레임(Ethernet frame)
1. 이더넷 프레임이란
    - 이더넷 네트워크에서 주고받는 프레임
    - 상위 계층으로부터 받아들인 정보에 헤더와 트레일러를 추가하는 캡슐화 과정을 통해 생성
    - 프리앰블, 수신지 MAC 주소, 송신지 MAC 주소, 타입/길이, 데이터, FCS로 구성<br><br>

2. 이더넷 프레임 속성
    - 프리앰블(preamble)
        - 송수신지 간의 동기화를 위해 사용되는 8바이트 크기의 정보
        - 첫 7바이트는 10101010이고, 마지막 바이트는 10101011 값을 보유
        - 이더넷 프레임 시작을 알리기에 수신지가 이더넷 프레임이 오고 있음을 파악 가능
    - 송수신지 MAC 주소
        - 네트워크 인터페이스마다 부여되는 6바이트 크기의 물리적 주소
        - LAN 내의 송수신지 특정 가능
        - 같은 네트워크 내에서 동일한 MAC 주소를 가진 기기들이 있다면 송수신지를 특정할 수 없기에 일반적으로 고유하고, 변경되지 않는 주소로써 네트워크 인터페이스마다 부여
    - 타입/길이
        - 필드에 명시된 크기가 1500(16진수 05DC) 이하일 경우 프레임의 크기(길이)를 나타내는 데 사용되고, 1536(16진수 0600) 이상일 경우 타입을 나타내는 데 사용
            - 타입 : 이더넷 프레임이 '어떤 정보를 캡슐화했는지'를 나타내는 정보(이더타입(ethertype))로, 대표적으로 상위 계층에서 사용된 프로토콜의 이름이 명시
    - 데이터
        - 상위 계층에서 전달받거나 전달해야 할 내용
        - 네트워크 계층의 데이터와 헤더를 합친 PDU가 이곳에 포함
        - 최대 크기는 1500바이트로, 반드시 일정 크기(46바이트 이상)여야 함
            - 일정 크기 이하의 데이터라면 크기를 맞추기 위해 패딩이라는 정보가 내부에 채워짐
    - FCS(Frame Check Sequence)
        - 수신한 이더넷 프레임에 오류가 있는지 확인하기 위한 필드
            - 데이터 링크 계층에서 이루어지는 오류 검출이 여기서 이루어짐
        - 순환 중복 검사(CRC, Cyclic Redundancy Check)라고 불리는 오류 검출용 값이 존재
            - 송신지는 프리앰블을 제외한 나머지 필드 값들을 바탕으로 CRC 값을 계산한 후, 이 값을 FCS 필드에 명시
            - 수신지는 수신한 프레임에서 프리앰블과 FCS 필드를 제외한 나머지 필드 값들을 바탕으로 CRC 값을 계산한 뒤, 이 값을 FCS 필드 값과 비교
            - 비교 값이 일치하지 않으면 프레임에 오류가 있다고 판단하여 해당 프레임을 폐기<br><br>

## 6. 토큰 링(Token Ring)
1. 토큰 링이란
    - 이더넷 외의 다른 LAN 기술
    - 네트워크에서 호스트들이 링(고리) 형태로 연결
    - 호스트끼리 돌아가며 토큰이라는 특별한 정보를 주고받으며, 네트워크 내 다른 호스트에게 메시지를 송신하려면 반드시 이 토근을 가지고 있어야 함<br><br>

2. 토큰 링의 메시지 전송 과정
    - 현재 토큰이 A에게 있는 경우 지금은 A만 메시지 전송이 가능하고, B, C, D는 송신 불가능
    - A가 메시지 전송이 끝나면 다음 컴퓨터(가령 B)에게 토큰을 넘김
    - B가 송신할 메시지가 없다면 다음 컴퓨터(가령 C)에게 토큰을 그대로 넘김
    - C가 송신하고자 하는 메시지가 있었다면 이제 비로소 송신 가능<br><br>

## 7. NIC(Network Interface Controller)
1. NIC란
    - 호스트와 통신 매체 사이의 인터페이스 역할을 담당하는 네트워크 장비<br><br>

2. NIC의 형태
    - 초기에는 확장 카트 형태로 따로 연결하여 사용했기에 '카드'라는 표현이 붙어 다양한 명칭으로 불림
    - 요즘에는 USB에 연결하거나 마더보드에 내장되는 등 형태가 다양해짐<br><br>

3. NIC의 역할
    - 네트워크와의 연결점을 담당한다는 점에서 네트워크 인터페이스 역할을 수행
        - 통신 매체에 흐르는 신호를 호스트가 이해하는 프레임으로 변환하거나 반대로 호스트가 이해하는 프레임을 통신 매체에 흐르는 신호로 변환함
        - 즉, 호스트가 네트워크를 통해 송수신하는 정보는 NIC를 거침<br><br>

4. NIC의 지원 속도
    - NIC마다 지원대는 속도가 다름
    - 통신 매체에 신호가 고속으로 흐른다면 그 속도에 맞춰 움직여야 하기에 내장되 있더라도 높은 대역폭에서 많은 트래픽을 감당해야 하는 서버와 같은 환경에서는 고속의 NIC가 추가로 필요<br><br>

## 8. 케이블
1. 케이블이란
    - NIC에 연결되는 물리 계층의 유선 통신 매체<br><br>

2. 트위스티드 페어 케이블(Twisted Pair Cable)
    - 트위스티드 페어 케이블이란
        - 구리 선으로 전기 신호를 주고받는 유선 통신 매체(예 : LAN 케이블)
    - 트위스티드 페어 케이블의 형태
        - 케이블 본체와 케이블의 연결부인 커넥터(= RJ-45)로 구성
        - 본체 내부는 구리 선이 두 가닥씩 꼬아져 있음
        - 구리 선으로 이루어진 상태에서 전기 신호를 주고받다 보면 구리 선에 전기 신호를 왜곡시킬 수 있는 간섭인 노이즈가 발생 가능
        - 노이즈로부터 구리선을 보호하기 위해 그물 모양의 철사인 브레이드 실드(braided shield)와 포일 실드(foil shield)로 감쌈(= 차폐(shielding) 방식)
    - 실드에 따른 트위스티드 페어 케이블의 분류
        - 종류
            - STP(Shielded Twisted Pair) : 브레이드 실드로 구리 선을 감싸 노이즈를 감소시킨 트위스티드 페어 케이블
            - FTP(Foil Twisted Pair) : 포일 실드로 노이즈를 감소시킨 트위스티드 페어 케이블
            - UTP(Unshielded Twisted Pair) : 아무것도 감싸지 않은 구리 선만 있는 케이블
        - 케이블 명칭 표기
            - XX 영역 : 케이블 외부를 감싸는 실드의 종류가 명시되며, 하나 혹은 두 개일 수도 있음
                - U : 실드 없음
                - S : 브레이드 실드
                - F : 포일 실드
            - Y 영역 : 꼬인 구리 선 쌍을 감싸는 실드의 종류가 명시
            - 예
                - S/FTP 케이블 : 케이블 외부는 브레이드 실드로 보호되며, 꼬인 각 구리 선 쌍은 포일 실드로 감싼 케이블
                - F/FTP 케이블 : 케이블 외부와 각 구리 선 쌍을 모두 포일 실드로 감싼 케이블
                - SF/FTP 케이블 : 케이블 외부는 브레이드 실드와 포일 실드로 감싸고, 각 구리 선 쌍은 포일 실드로 감싼 케이블
                - U/UTP 케이블 : 아무것도 감싸지 않은 케이블
    - 카테고리에 따른 트위스티드 페어 케이블의 분류
        - 카테고리
            - 트위스티드 페어 케이블 성능의 등급을 구분하는 역할(카테고리 ↑ → 성능 ↑)
            - Category에서 앞의 세 글자를 딴 Cat이라는 표기로 줄여 표현
        - 가장 대표적으로 활용되는 카테고리 분류표
            |특징|Cat5|Cat5e|Cat6|Cat6a|Cat7|Cat8|
            |---|---|---|---|---|---|---|
            |지원 대역폭|100MHz|100MHz|250MHz|500MHz|600MHz|2GHz|
            |주요 대응 규격|100BASE-TX|1000BASE-T|1000BASE-TX|10GBASE-T|10GBASE-T|40GBASE-T|
            |전송 속도|100Mbps|1Gbps|10Gbps|10Gbps|10Gbps|40Gbps|<br><br>

3. 광섬유 케이블(Fiber Optic Cable)
    - 광섬유 케이블이란
        - 광섬유를 통해 광신호를 주고받는 유선 통신 매체
        - 전기 신호를 이용하는 케이블에 비해 더 빠르고 먼 거리까지 전송 가능하며, 노이즈로부터 간섭받는 영향이 적어 대륙 간 네트워크 연결에도 사용
    - 광섬유 케이블의 형태
        - 트위스티드 페어 케이블과 마찬가지로 케이블 본체와 다양한 종류의 커넥터(LC, SC, FC, ST 커넥터 등)로 구성
        - 광섬유의 중심에는 코어와 코어를 둘러싸는 클래딩이 존재
            - 코어(core) : 광섬유에서 실직적으로 빛이 흐르느 부분
            - 클래딩(cladding) : 빛이 코어 안에서만 흐르도록 빛을 가두는 역할을 수행
    - 코어의 지름에 따른 광섬유 케이블의 분류표
        |특징(상대 비교)|싱글 모드 광섬유 케이블(SMF, Single Mode Fiber)|멀티 모드 광섬유 케이블(MMF, Multi Mode Fiber)|
        |---|---|---|
        |코어 지름|작음(8 ~ 10µm)|큼(50 ~ 62.5µm)|
        |빛의 이동 경로|하나|여러 개|
        |거리 전송|장거리|근거리|
        |신호 손실|적음|많음|
        |사용하는 빛의 파장|장파장|단파장|
        |비용|높음|낮음|
        |대표 규격|1000BASE-LX, 10GBASE-LR|1000BASE-SX, 10GBASE-SR|
        - µm : 길이의 단의로, 마이크로미터라고 읽음(1µm = 1,000µm, 머리카락 평균 두께 ≒ 50 ~ 150µm)
        - L : 장(Long)파장
        - S : 단(Short)파장
    - 케이블 본체의 색상에 따른 광섬유 케이블의 분류
        - 싱글 모드 광섬유 케이블 본체의 색상 : 노란색/파란색
        - 멀티 모드 광섬유 케이블 본체의 색상 : 오렌지색/아쿠아색<br><br>

## 9. 허브
1. 주소 개념이 없는 물리 계층
    - 물리 계층에는 주소 개념이 없음
        - 단 호스트와 통신 매체 간의 연결과 통신 매체상의 송수신이 이루어짐
        - 물리 계층의 네트워크 장비는 송수신되는 정보에 대한 어떠한 조작(송수신 내용 변경)이나 판단을 하지 않음
    - 데이터 링크 계층에는 주소 개념이 있음
        - MAC 주소가 여기에 속함
        - 데이터 링크 계층의 장비나 그 이상 계층의 장비들은 송수신지를 특정할 수 있고, 주소를 바탕으로 송수신되는 정보에 대한 조작과 판단을 할 수 있음<br><br>

2. 허브
    - 허브란
        - 여러 대의 호스트를 연결할 수 있는 물리 계층의 장비로 전달받은 신호를 다른 모든 포트로 내보내며 반이중 모드로 통신함
        - 리피터 허브(repeater hub), 이더넷 허브(Ethernet hub)라고도 부름
            - 리피터
                - 허브 이외의 물리 계층의 대표적인 장비
                - 전기 신호가 감소하거나 왜곡되는 것을 방지하기 위해 전기 신호를 증폭시켜주는 장비
                - 물리 계층의 장비이므로 신호에 대한 어떠한 판단이나 조작을 하지 않고, 그저 신호만 증폭시킴
                - 허브는 이러한 리피터의 기능을 포함하는 경우가 많음
    - 허브의 특징
        - 전달받은 신호를 다른 모든 포트로 그대로 다시 내보냄
            - 허브는 물리 계층에 속하는 장비고, 물리 계층에서는 주소 개념이 없기에 허브는 수신지를 특정할 수 없음
            - 신호를 전달받으면 어떠한 조작이나 판단을 하지 않고 송신지를 제외한 모든 포트에 그저 내보내기만 함
            - 허브를 통해 전달받은 모든 호스트는 데이터 링크 계층에서 패킷의 MAC 주소를 확인하고 자신과 관련 없는 주소는 폐기
        - 반이중 모드로 통신함
            - 반이중(half duflex) 모드 : 데이터를 한 번에 한 방향으로만 전송할 수 있는 통신 방식
            - 전이중(full duflex) 모드 : 동시에 양방향으로 전송할 수 있는 통신 방식
    - 콜리전 도메인(collision domain)
        - 허브는 반이중 통신을 지원하기에 호스트들이 동시에 허브로 신호를 송신하면 충돌(collision)이 발생
        - 충돌이 발생할 수 있는 영역을 콜리전 도메인이라고하며, 허브에 연결된 모든 호스트는 같은 콜리전 도메인에 속함
        - 허브의 넓은 콜리전 도메인으로 인한 충돌 문제를 해결하기 위해 CSMA/CD 프로토콜을 사용하거나 스위치 장비를 사용<br><br>

3. CSMA/CD(Carrier Sense Multiple Access with Collision Detection)
    - CSMA/CD란
        - 반이중 이더넷 네트워크의 충돌 방지 프로토콜
        - 여러 호스트가 공유하는 통신 매체에 접근할 때 사용 가능한 제어 방식이라는 점에서 매체 접근 제어(MAC, Media Access Control) 방법의 일종이라고도 부름
    - CS
        - 캐리어 감지를 의미하며, 현재 통신 매체의 사용 가능 여부를 검사하는 것
        - 엄밀히 말하면 반송파 감지를 의미 = '통신 매체상에서 흐르는 신호 감지'
    - MA
        - 다장 접근을 의미하며, 캐리어 감지를 하는 데도 복수의 호스트가 네트워크에 접근하려는 다중 접근 상황이 발생하면 충돌이 발생
    - CD
        - 충돌 검출을 의미
            - 충돌을 감지하면 전송을 중단
            - 충돌을 검출한 호스트는 다른 이들에게 충돌이 발생했음을 알리고자 잼 신호(jam signal)라는 특별한 신호를 보냄
            - 임의의 시간 동안 기다린 뒤에 다시 전송<br><br>

## 10. 스위치(switch)
1. 스위치란
    - 포트별로 콜리전 도메인을 나누며 전이중 모드 통신을 지원하는 데이터 링크 계층의 장비
        - 2계층에서 사용한다 하며 L2 스위치라고도 부름(데이터 링크 계층 상위 계층에서 사용되는 L3, L4 스위치 등도 있음)
    - MAC 주소 테이블로 MAC 주소를 학습해 원하는 포트로 패킷을 포워딩하고 원치 않은 포트는 필터링할 수 있음<br><br>

2. 스위치의 특징
    - MAC 주소 학습(MAC addressing learning)
        - 특정 포트와 해당 포트에 연결된 호스트의 MAC 주소와의 관계를 기억하여 원하는 호스트에만 프레임 전달이 가능
        - MAC 주소 학습을 위해 포트와 연결된 호스트의 MAC 주소 간의 연관 관계를 메모리 내의 MAC 주소 테이블(MAC address table)에 저장<br><br>

## 11. MAC 주소 학습
1. MAC 주소 테이블은 어떻게 채워지고 유지되며, 스위치는 어떻게 원하는 수신지가 연결된 포트에만 프레임을 내보낼 수 있는가
    - 호스트 A, B, C, D가 각각 포트 1, 2, 3, 4번에 연결되어 있고, 호스트 A가 호스트 C로 프레임을 전송하는 상황을 가정
        - 스위치는 처음 어떤 포트에 어떤 MAC 주소를 가진 호스트가 연결되어 있는지 학습하지 않아 호스트 A, B, C, D의 MAC 주소와 연결된 포트의 연관 관계를 알지 못함
        - 스위치의 MAC 주소 학습은 프레임 내 '송신지 MAC 주소' 필드를 바탕으로 이루어짐
            - 스위치가 처음 호스트 A에서 프레임을 수신하면, 프레임 내 '송신지 MAC 주소'를 바탕으로 호스트 A의 MAC 주소와 연결된 포트를 MAC 주소 테이블에 저장
            - 하지만, 여전히 수신지 호스트 C가 어느 포트에 연결되었는지 모름
        - 이 상황에서 스위치는 허브처럼 송신지 포트를 제외한 모든 포트로 프레임을 전송 = 플러딩(flooding)
            - 호스트 B, C, D는 프레임을 전달받음
            - 호스트 B, D는 자신과 관련이 없는 프레임을 전송받은 셈이므로 이를 폐기
            - 호스트 C는 스위치로 응담 프레임을 전송
                - 스위치는 응답 프레임의 '송신지 MAC 주소' 필드에 명시된 호스트 C의 MAC 주소와 연결된 포트를 알아내어 이 정보를 MAC 주소 테이블에 저장
        - 스위치는 호스트 A와 C의 MAC 주소와 연결된 포트를 알고 있으므로 두 호스트가 프레임을 주고받을 때는 다른 포트를 프레임을 내보낼 필요가 없게 됨
            - 필터링(filtering) : 전달받은 프레임을 어디로 내보내고 어디로 내보내지 않을지 결정하는 스위치의 기능
        - 프레임이 전송될 포트에 실제로 프레임을 내보냄 = 포워딩(forwarding)
        - 만약, MAC 주소 테이블에 등록된 특정 포트에서 일정 시간 동안 프레임을 전송받지 못했다면 해당 항목은 삭제됨 = 에이징(aging)<br><br>

## 12. VLAN(Virtual LAN)
1. VLAN이란
    - 스위치를 만들 수 있는 가상의 LAN
    - 허브는 송신지 포트를 제외한 모든 포트로 신호를 내보내기에 네트워크상에 불필요한 트래픽이 늘어날 수밖에 없고, 이는 성능 저하로 이어짐(스위치도 마찬가지)
        - 스위치에 연결된 호스트 중에서도 서로 메시지를 주고받을 일이 적거나 브로드캐스트 메시지를 받을 필요가 없어서 굳이 같은 네트워크(LAN)에 속할 필요가 없는 호스트가 있을 수도 있음
        - 이를 분리하고자 매번 새로운 스위치 장비를 구비하는 것은 낭비이며, 이때 구성하는 것이 VLAN
    - VLAN을 구성하면 한 대의 물리적 스위치라 해도 여러 대의 스위치가 있는 것처럼 논리적인 단위로 LAN 구획이 가능<br><br>

2. VLAN을 구성하는 방법
    - 포트 기반 VLAN(port based LAN)
        - 가장 단순하지만 대중적인 방식으로, 스위치의 포트가 VLAN을 결정하는 방식
        - 사전에 특정 포트에 VLAN을 할당하고, 해당 포트에 호스트를 연결함으로써 VLAN에 포함시킬 수 있음
        - 포트 수가 부족해질 수 있다는 문제가 있으며, VLAN 트렁킹(VLAN Trunking)을 이용하여 해결
            - 두 대 이상의 VLAN 스위치를 효율적으로 연결하여 확장하는 방법
            - 스위치 간의 통신을 위한 특별한 포트인 트렁크 포트에 VLAN 스위치를 서로 연결하는 방식
                - 트렁크 포트 : 태그 포트라고 부르며, 트렁크 포트가 아닌 하나의 VLAN이 할당된 일반적인 포트는 액세스 포트라고 함
            - 트렁크 포트로 전달받은 프레임이 어떤 VLAN에 속하는지 파악하기 위해 이더넷 프레임 사이에 32비트 크기의 VLAN 태그라는 정보까지 추가된 확장된 이더넷 프레임인 802.1Q 프레임을 사용
    - MAC 기반 VLAN(MAC based LAN)
        - 송수신하는 프레임 속 MAC 주소가 호스트가 속한 VLAN을 결정하는 방식
        - 예를 들어 호스트 A의 MAC 주소가 VLAN3에 할당되었다면, 어떤 포트에 연결되든 호스트 A는 VLAN3에 속한 호스트로 동작