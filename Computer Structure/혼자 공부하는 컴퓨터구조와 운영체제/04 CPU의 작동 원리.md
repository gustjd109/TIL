# 04 CPU의 작동 원리

## 1. ALU와 제어장치
1. ALU
    - ALU가 받는 정보
        - 레지스터를 통해 피연산자를, 제어장치로부터 수행할 연산을 알려주는 제어 신호를 받아들여 연산을 수행
    - ALU가 내보내는 정보
        - 결괏값 : 연산을 수행한 결괏값은 메모리에 저장하지 않고 일시적으로 레지스트에 저장
            - CPU가 메모리에 접근하는 속도 < 레지스터에 접근하는 속도
            - ALU가 연산할 때마다 결과를 메모리에 저장 → CPU가 메모리에 자주 접근 → CPU 프로그램 실행 속도 ↓
        - 플래그(flag) : 연산 결과에 대한 추가적인 상태 정보로, 플래그 레지스터에 저장
            - 플래그 종류
                | 플래그 종류 | 의미 | 사용 예시 |
                |:--------:|:--------:|:--------:|
                | 부호 플래그 | 연산한 결과의 부호 | 1일 경우 계산 결과는 음수, 0일 양수 |
                | 제로 플래그 | 연산 결과가 0인지 여부 | 1일 경우 연산 결과는 0, 0일 경우 0이 아님 |
                | 캐리 플래그 | 연산 결과 올림수나 빌림수 발생 여부 | 1일 경우 올림수나 빌림수가 발생, 0일 경우 발생하지 않음 |
                | 오버플로우 플래그 | 오버플로우 발생 여부 | 1일 경우 오버플로우 발생, 0일 경우 발생하지 않음 |
                | 인터럽트 플래그 | 인터럽트가 가능한지 여부 | 1일 경우 인터럽트 가능, 0일 경우 불가능 |
                | 슈퍼바이저 플래그 | 커널 모드로 실행 중인지, 사용자 모드로 실행 중인지 여부 | 1일 경우 커널 모드로 실행 중, 0일 경우 사용자 모드로 실행 중 |<br><br>

2. 제어장치
    - 제어장치가 받는 정보
        - 클럭 신호 : 클럭의 주기에 맞춰 레지스터 간의 데이터가 이동되거나, ALU에서 연산이 수행되거나, CPU가 메모리에 저장된 명령어를 읽어들이는 등의 작업 수행
            - 클럭(clock) : 컴퓨터의 모든 부품을 움직일 수 있게 하는 단위
        - 해석해야할 명령어 : 명령어 레지스터로부터 해석할 명령어를 받아 해석한 뒤, 제어 신호를 발생시켜 컴퓨터 부품들에 수행할 내용을 알림
        - 플래그 값 : 받은 값을 참고하여 제어 신호를 발생
        - 시스템 버스(그중에서 제어 버스로 전달된 제어 신호) : 제어 버스를 통해 외부로부터 전달된 제어 신호를 받음
    - 제어장치가 내보내는 정보
        - CPU 외부에 전달하는 제어 신호 : 제어 버스로 제어 신호를 내보낸다는 의미
            - 메모리에 전달하는 제어 신호 : 메모리에 저장된 값을 읽거나 새로운 값을 쓰고 싶을 때 메모리로 제어 신호를 보냄
            - 입출력장치(보조기억장치)에 전달하는 제어 신호 : 입출력장치의 값을 읽거나 새로운 값을 쓰고 싶을 때 입출력장치로 제어 신호를 보냄
        - CPU 내부에 전달하는 제어 신호
            - ALU에 전달하는 제어 신호 : ALU에 수행할 연산 지시를 위해 제어 신호를 보냄
            - 레지스터에 전달하는 제어 신호 : 레지스터에 레지스터 간 데이터를 이동시키거나 레지스터에 저장된 명령어를 해석하기 위해 제어 신호를 보냄<br><br>

## 2. 레지스터
1. 레지스터 종류
    - 프로그램 카운터(PC, Program Counter)
        - 메모리에서 읽어 들일 명령어의 주소를 저장하는 레지스터 = 명령어 포인터(IP, Instruction Pointer)
    - 명령어 레지스터(IR, Instruction Register)
        - 메모리에서 읽어 들인 명령어를 저장하는 레지스터
    - 메모리 주소 레지스터(MAR, Memory Address Register)
        - 메모리의 주소를 저장하는 레지스터
        - CPU가 읽어 들이고자 하는 주소 값을 주소 버스로 보낼 때 메모리 주소 레지스터를 거침
    - 메모리 버퍼 레지스터(MBR, Memory Buffer Register)
        - 메모리와 주고받을 값(데이터와 명령어)을 저장하는 레지스터 = 메모리 데이터 레지스터(MDR, Memory Data Register)
        - 메모리에 쓰고 싶은 값이나 메모리로부터 전달받은 값은 메모리 버퍼 레지스터를 거침
        - CPU가 데이터 버스로 주고 받을 값은 메모리 버퍼 레지스터를 거침
    - 메모리에 저장된 프로그램을 실행하는 과정
        - CPU로 실행할 프로그램이 1000 ~ 1500번지까지 저장되어 있고, 1000번지에는 1101₂이 저장되어 있다고 가정
            - 프로그램 카운터에 1000이 저장
                - 메모리에서 가져올 명령어가 1000번지에 있다는 의미
            - 메모리 주소 레지스터에 1000이 저장
                - 1000번지를 읽어들이기 위해 주소 버스로 1000번지를 내보내야 함
            - '메모리 읽기' 제어 신호와 메모리 주소 레지스터 값이 각각 제어 버스와 주소 버스를 통해 메모리로 보내짐
            - 메모리 1000번지에 저장된 값은 데이터 버스를 통해 메모리 버퍼 레지스터로 전달
                - 프로그램 카운터가 1000에서 1001로 증가되어 다음 명령어를 읽어 들일 준비를 함
            - 메모리 버퍼 레지스터에 저장된 값은 명령어 레지스터로 이동
            - 제어장치는 명령어 레지스터의 명령어를 해석하고 제어 신호를 발생
            - 위 과정을 반복하면서 CPU는 프로그램을 차례대로 실행
    - 범용 레지스터(GPR, General Purpose Register)
        - 다양하고 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터로 데이터와 주소를 모두 저장하는 레지스터
    - 플래그 레지스터(FR, Flag Register)
        - 연산 결과 또는 CPU 상태에 대한 부가적인 정보를 저장하는 레지스터
    - 스택 포인터(SP, Stack Pointer)
        - 스택 주소 지정 방식에 사용되는 레지스터로, 스택에 마지막으로 저장한 값의 위치를 저장하는 레지스터
        - 스택은 메모리 안에 스택처럼 사용할 영역인 스택 영역에서 사용
    - 베이스 레지스터(BR, Base Register)
        - 베이스 레지스터 주소 지정 방식에 사용되는 레지스터로, 기준 주소가 저장되는 레지스터