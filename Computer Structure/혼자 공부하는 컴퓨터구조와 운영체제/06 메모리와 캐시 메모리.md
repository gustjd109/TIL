# 06 메모리와 캐시 메모리

## 1. RAM의 특징과 종류
1. RAM의 특징
    - 실행할 프로그램의 명령어와 데이터가 저장
    - 전원을 끄면 저장된 내용이 사라지는 저장 장치인 휘발성 저정 장치(volatile memory)로, '실행할 대상'을 저장
        - 비휘발성 저장 장치(non-volatile memory) : 전원이 꺼져도 저장된 내용이 유지되는 저장 장치로, '보관할 대상'을 저장
            - 대표적 비휘발성 저장 장치 : 하드 디스크, SSD, CD-ROM, USB 메모리와 같은 보조기억장치<br><br>

2. RAM의 용량과 성능
    - 용량
        - RAM 용량이 적다면 보조기억장치에서 실행할 프로그램을 가져오는 일이 잦아 실행 시간이 길어짐
        - RAM 용량이 크다면 보조기억장치에서 많은 데이터를 가져와 미리 RAM에 저장 가능하여 많은 프로그램을 동시에 실행하는 데 유리
    - 성능
        - RAM 용량이 커지면 프로그램 실행 속도가 증가하지만, 필요 이상으로 커졌을 때 속도가 그에 비례하여 증가하지는 않음<br><br>

3. RAM의 종류
    - DRAM(Dynamic RAM)
        - 저장된 데이터가 동적으로 변하는(사라지는) RAM
        - 데이터의 소멸을 막기 위해 일정 주기로 데이터를 재활성화(다시 저장)해야 함
        - 소비 전력이 낮고, 저렴하고, 집적도가 높아 대용량으로 설계하기 용이하여 일반적으로 메모리로써 사용
            - 집적도가 높다 : 더 작고 빽빽하게 만들 수 있다는 의미
    - SRAM(Static RAM)
        - 시간이 지나면 점차 저장된 내용이 소실되는 DRAM과 달리 저장된 데이터가 변하지 않는 RAM
        - 주기적으로 데이터를 재활성화할 필요가 없음
        - DRAM보다 속도가 더 빠르고, 집적도가 낮고 ,소비 전력도 크며, 가격이 비싸 '대용량으로 만들어질 필요는 없지만 속도가 빨라야 하나는 저장 장치'인 캐시 메모리에서 사용
    - SDRAM(Synchronouse Dynamic RAM)
        - 클럭 신호와 동기화된, 발전된 형태의 DRAM = 클럭에 맞춰 동작하며 클럭마다 CPU와 정보를 주고받을 수 있는 DRAM
            - 클럭 신호와 동기화되었다 : 클럭 타이밍에 맞춰 CPU와 정보를 주고받을 수 있다는 의미
    - DDR SDRAM(Double Data Rate SDRAM)
        - 최근 가장 흔히 사용되는 RAM으로, 대역 폭을 넓혀 속도를 빠르게 만든 SDRAM
            - 대역폭(data rate) : 데이터를 주고받는 길의 너비
        - 한 클럭당 하나씩 데이터를 주고받을 수 있는 SDRAM을 SDR SDRAM(Single Data Rate SDRAM)이라고 부름<br><br>

## 2. 메모리의 주소 공간
1. 물리 주소와 논리 주소
    - 물리 주소(physical address) : 메모리 하드웨어 상의 주소
    - 논리 주소(logical address) : CPU와 실행 중인 프로그램이 사용하는 주소<br><br>

2. 논리 주소를 물리 주소로 변환하는 방법
    - CPU와 주소 버스 사이에 위치한 메모리 관리 장치(MMU, Memory Management Unit)이라는 하드웨어에 의해 수행
    - MMU는 CPU가 발생시킨 논리 주소에 베이스 레지스터 값을 더하여 논리 주소를 물리 주소로 변환
        - 베이스 레지스터 : 프로그램의 가장 작은 물리 주소, 즉 프로그램의 첫 물리 주소를 저장<br><br>

3. 메모리 보호 기법
    - 한계 레지스터를 이용하여 다른 프로그램의 영역 침범 및 논리 주소 범위를 벗어나는 명령어 실행을 방지하여 시행 중인 프로그램이 다른 프로그램에 영향을 받지 않도록 보호
        - 한계 레지스터(limit register) : 논리 주소의 최대 크기를 저장
    - 프로그램의 물리 주소 범위는 베이스 레지스터 값 이상, 베이스 레지스터 값 + 한계 레지스터 값 미만이 됨
    - CPU는 메모리에 접근하기 전에 접근하고자 하는 논리 주소가 한계 레지스터보다 작은지를 항상 검사하며, 만약 CPU가 한계 레지스터보다 높은 논리 주소에 접근하려고 하면 인터럽트(트랩)을 발생시켜 실행을 중단<br><br>

## 3. 캐시 메모리
1. 저장 장치 계층 구조(memory hierarchy)
    - 모든 사용자들은 빠르고 동시에 용량이 큰 저장 장치를 요구
        - '빠른 저장 장치'와 '용량이 큰 저장 장치'는 양립하기 다음과 같은 이유로 어려움
            - CPU와 가까운 저장 장치는 빠르고, 멀리 있는 저장 장치는 느림
            - 속도가 빠른 저장 장치는 저장 용량이 작고, 가격이 비쌈
    - 지금까지 배운 저장 장치 계층
        - 레지스터 ↔︎ 메모리 ↔︎ 보조기억장치
        - 위로 올라갈수록 속도가 빠르고, 용량이 작고, 가격이 비쌈<br><br>

2. 캐시 메모리(cache memory)
    - CPU와 메모리 사이에 위치하고, 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치
    - CPU의 연산 속도와 메모리 접근 속도의 차이를 줄이기 위해 탄생
    - 캐시 메모리를 반영한 저장 장치 계층
        - 레지스터 ↔︎ 캐시 메모리 ↔︎ 메모리 ↔︎ 보조기억장치<br><br>

3. L1, 2, 3 캐시
    - 캐시 메모리들은 CPU(코어)와 가까운 순서대로 계층을 구성
    - 코어와 가장 가까운 캐시 메모리를 L1(Level 1) 캐시, 그다음 가까운 캐시 메모리를 L2(Level 2) 캐시, 그다음 가까운 캐시 메모리를 L3(Level 3) 캐시
    - L1과 L2 캐시는 코어 내부에, L3 캐시는 코어 외부에 위치
    - 캐시 메모리의 용량은, L1, L2, L3 순으로 커지고, 속도는 L3, L2, L1 순으로 빠르고, 가격은 L3, L2, L1 순으로 비쌈
    - 멀티 코어 프로세서에서의 L1, L2, L3 캐시
        - L1 캐시와 L2 캐시는 코어마다 고유한 캐시 메모리로 할당되고, L3 캐시는 여러 코어가 공유하는 형태로 사용
    - 분리형 캐시(split cache)
        - 코어와 가장 가까운 L1 캐시는 조금이라도 접근 속도를 빠르게 만들기 위해 명렁어만을 저장하는 L1 캐시인 L1| 캐시와 데이터만을 저장하는 L1 캐시인 L1D 캐시로 분리
    - 캐시 메모리를 L1, 2, 3 캐시로 구분한 것을 반영한 저장 장치 계층
        - 레지스터 ↔︎ L1 캐시 ↔︎ L2 캐시 ↔︎ L3 캐시 ↔︎ 메모리 ↔︎ 보조기억장치<br><br>

4. 참조 지역성 원리(locality of reference, principle of locality)
    - 캐시 메모리는 CPU가 사용할 법한 대상을 예측하여 저장
        - 캐시 히트(cache hit) : 자주 사용될 것으로 예측한 데이터가 실제로 들어맞아 캐시 메모리 내 데이터가 CPU에서 활용될 경우
        - 캐시 미스(cache miss) : 자주 사용될 것으로 예측하여 캐시 메모리에 저장했지만, 예측이 틀려 메모리에서 필요한 데이터를 직접 가져와야 하는 경우
            - 캐시 미스가 발생하면 CPU가 필요한 데이터를 메모리에서 직접 가져와야 하기 때문에 캐시 메모리의 이정을 활용할 수 없음
            - 캐시 미스가 자주 발생하면 성능이 떨어짐
        - 캐시 적중률(cache hit ratio) : 캐시 히트 횟수 / (캐시 히트 횟수 + 캐시 미스 횟수)
            - 캐시 적중률이 높으면 CPU의 메모리 접근 횟수를 줄일 수 있음
    - 캐시 메모리는 참조 지역성의 원리 원칙에 따라 CPU가 사용할 법한 데이터를 알 수 있고 메모리로부터 가져올 수 있음
        - 시간 지역성(temporal locality) : CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있음
            - CPU는 최근에 접근했던 변수나 데이터를 사용하기 위해 저장된 메모리 공간을 여러 번 다시 접근할 수 있음
        - 공간 지역성(spatial locality) : CPU는 접근한 메모리 공간 근처를 접근하려는 경향이 있음
            - 예를 들어, CPU가 워드 프로세서 프로그램을 실행할 적에는 워드 프로세서 프로그램이 모여 있는 공간 근처를 집중적으로 접근할 것