# 13 교착 상태

## 1. 교착 상태란
1. 식사하는 철학자 문제(dining philosophers problem)
    - 문제 정의
        - 동그란 원탁에 다섯 명의 철학자가 앉아 있음
        - 철학자들 앞에는 식사가 있고, 철학자들 사이에는 포크가 있음
        - 철학자들 앞에 있는 식사는 두 개의 포크로 먹을 수 있음<br><br>

    - 철학자들이 식사하는 순서
        - 계속 생각하다가 왼쪽 포크가 사용 가능하면 집어듦
        - 계속 생각하다가 오른쪽 포크가 사용 가능하면 집어듦
        - 왼쪽과 오른쪽 포크를 모두 집어들면 정해진 시간동안 식사를 함
        - 식사 시간이 끝나면 오른쪽 포크를 내려놓음
        - 오른쪽 포크를 내려놓은 뒤 왼쪽 포크를 내려놓음
        - 위 과정을 반복<br><br>

    - 식사하는 철학자 문제에서 발생한 교착 상태
        - 모든 철학자가 동시에 포크를 집어 식사하면 어떤 철학자도 식사를 할 수 없음
        - 다른 철학자가 포크를 내려놓을 때까지 기다려야 함
        - 즉, 교착 상태란 일어나지 않을 사건을 기다리며 무한히 대기하는 현상
        - 여기서 철학자는 프로세스 혹은 스레드, 포크는 자원, 생각하는 행위는 자원를 기다리는 것으로 볼 수 있음<br><br>

2. 교착 상태 발생 조건
    - 상호 배제(mutual exclusion) : 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없는 경우
    - 점유와 대기(hold and wait) : 한 프로세스가 어떠한 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 경우
    - 비선점(nonpreemptive) : 어떠한 프로세스가 다른 프로세스의 자원을 강제로 빼앗지 못하는 경우
    - 원형 대기(circular wait) : 프로세스들과 프로세스가 요청 및 할당받은 자원이 원의 형태를 이룬 경우<br><br>

3. 교착 상태 해결 방법
    - 교착 상태 예방
        - 교착 상태 예방이란
            - 교착 상태의 발생 조건 중 하나를 충족하지 못하게 하는 방법<br><br>

        - 교착 상태 예방 4가지 방법
            - 자원의 상호 배제 없애기
                - 모든 자원을 공유 가능하게 만듦
                - 이론적으로는 교착 상태를 없앨 수 있지만, 현실적으로 모든 자원의 상호 배제를 없애기 어려움
            - 점유와 대기 없애기
                - 특정 프로세스에 자원을 모두 할당당하거나 아예 할당하지 않는 방식으로 배분
                - 당장 자원이 필요해도 기다릴 수밖에 없는 프로세스와 사용되지 않으면서 오랫동안 할당되는 자원을 다수 양산하기 때문에 자원의 활용률이 낮아짐
                - 많은 자원을 필요로 하는 프로세스가 무한정 기다리게 되는 기아 현상을 야기함
            - 비선점 조건 없애기
                - 자원을 이용 중인 프로세스로부터 해당 자원을 빼앗을 수 있게 함
                - 한 프로세스의 작업이 끝날 때까지 다른 프로세스가 기다려야 하는 자원도 있기 때문에 범용성이 떨어짐
            - 원형 대기 조건 없애기
                - 모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당
                - 모든 컴퓨터 시스템 내에 존재하는 수많은 자원에 번호를 붙이는 일은 간단한 작업이 아니기 때문에 각 자원에 어떤 번호를 붙이는지에 따라 특정 자원의 활용성이 떨어질 수 있음<br><br>

    - 교착 상태 회피
        - 교착 상태 회피란
            - 교착 상태가 발생하지 않을 정도로만 조심 조심 자원을 할당하는 방식 = 안전 상태를 유지하도록 자원을 할당하는 방식<br><br>

        - 안전 순서열, 안전 상태, 불안전 상태
            - 안전 순서열(safe sequence) : 교착 상태 없이 안전하기 프로세스들에 자원을 할당할 수 있는 순서
            - 안전 상태(safe status) : 안전 순서열대로 프로세스들에 자원을 배분하여 교착 상태가 발생하지 않는 상태
            - 불안전 상태(unsafe status) : 안전 순서열이 없는 상황으로, 교착 상태가 발생할 수도 있는 상황<br><br>

    - 교착 상태 검출 후 회복
        - 교착 상태 검출 후 회복이란
            - 교착 상태 발생 여부를 주기적으로 검사하고, 교착 상태가 발생하면 그때그때 회복하는 방식<br><br>

        - 회복 종류
            - 선점을 통한 회복
                - 교착 상태가 해결될 때까지 한 프로세스씩 자원ㅇㄹ 몰아주는 방식
            - 프로세스 강제 종료를 통한 회복
                - 프로세스 강제 종료를 통한 회복은 가장 단순하면서 확실한 방식
                - 운영체제는 교착 상태에 놓인 프로세스를 모두 강제 종료할 수도, 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료할 수도 있음
                    - 전자는 한 번에 교착 상태를 해결할 수 있지만, 많은 프로세스들의 작업 내역을 잃게 될 가능성이 있음
                    - 후자는 작업 내역을 잃는 프로세스는 최대한 줄일 수 있지만, 교착 상태가 없어졌는지 여부를 확인하는 과정에서 오버헤드를 야기함<br><br>

    - 타조 알고리즘(ostrich algorithm)
        - 교착 상태를 아예 무시하는 방식