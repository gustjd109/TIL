# 12 프로세스 동기화

## 1. 동기화(synchronization)란
1. 동기화의 의미
    - 동기화란
        - 특정 자원에 접근할 때 한 개의 프로세스만 접근하게 하거나, 프로세스를 올바른 순서대로 실행하게 하는 것
        - 협력하여 실행되는 프로세스들은 실행 순서와 자원의 일관성을 보장해야 하기에 동기화가 필요<br><br>

    - 동기화 종류
        - 실행 순서 제어를 위한 동기화 : 프로세스를 올바른 순서대로 실행하기 위한 동기화
        - 상호 배제를 위한 동기화 : 동기에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기 위한 동기화
            - 상호 배제(mutual exclusion) : 공유가 불가능한 자원의 동시 사용을 피하기 위해 사용하는 알고리즘<br><br>

2. 공유 자원과 임계 구역
    - 공유 자원(shared resource)
        - 공동으로 사용하는 자원으로, 전역 변수가 될 수도 있고, 파일이 될 수도 있고, 입출력장치, 보조기억장치가 될 수도 있음<br><br>

    - 임계 구역(critical section)
        - 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역<br><br>

    - 레이스 컨디션(race condition)
        - 여러 프로세스가 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우
        - 레이스 컨디션이 발생하면, 데이터의 일관성이 깨지는 문제가 발생<br><br>
    
    - 레이스 컨디션이 발생하는 이유
        - 컴퓨터는 고급 언어가 아닌 저급 언어를 실행하기 때문에 저급 언어로 변환된 고급 언어 코드를 실행하는 과정에서 문맥 교환이 발생
        - 이때 동기화가 제대로 이루어지지 않으면 문제가 발생
        - 이러한 문제가 발생하지 않도록 상호 배제 동기화는 두 개 이상의 프로세스가 임계 구역에 동시에 접근하지 못하도록 관리<br><br>

    - 임계 구역 문제를 해결하기 위한 운영체제의 세 가지 원칙
        - 상호 배제 : 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없음
        - 진행(progress) : 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 함
        - 유한 대기(bounded waiting) : 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 함<br><br>

## 2. 동기화 기법
1. 뮤텍스 락(Mutex lock, MUTual EXclusion lock)
    - 뮤텍스 락이란
        - 임계 구역을 잠금으로써 프로세스 간의 상호 배제를 이룸<br><br>

    - 뮤텍스 락의 단순한 형태
        - 자물쇠 역할 : 프로세스들이 공유하는 전역 변수 lock
        - 임계 구역을 잠그는 역할 : acquire 함수
            - 프로세스가 임계 구역에 진입하기 전에 호출하는 함수
            - 만일 임계 구역이 잠겨 있다면 임계 구역이 열릴 때까지 임계 구역을 반복적으로 확인하고, 임계 구역이 열러 있다면 임계 구역을 잠그는 함수
        - 임계 구역의 잠금을 해제하는 역할 : release 함수
            - 임계 구역에서의 작업이 끝나고 호출하는 함수
            - 현재 잠긴 임계 구역을 열어주는 함수<br><br>

    - 바쁜 대기(busy wait)
        - 프로세스가 락을 획득할 수 없다면(임계 구역에 진입할 수 없다면) 임계 구역이 잠겨 있는지를 반복적으로 확인하며 대기하는 방식<br><br>

2. 세마포(semaphore)
    - 세마포란
        - 공유 자원이 여러 개 있는 임계 구역 문제도 해결할 수 있는 동기화 도구
        - 이진 세마포(binary semaphore)와 카운팅 세마포(counting semaphore)가 있음<br><br>

    - 세마포의 단순한 형태
        - 세마포의 구성
            - 임계 구역에 진입할 수 있는 프로세스의 개수(사용 가능한 공유 자원의 개수)를 나타내는 전역 변수 S
            - 임계 구역에 들어가도 좋은지, 기다려야 할지를 알려주는 wait 함수
                - wait 함수 구현
                    - 임계 구역에 진입할 수 있는 프로세스 개수가 0 이하라면, 사용할 수 있는 자원이 있는지를 반복적으로 확인
                    - 임계 구역에 진입할 수 있는 프로세스 개수가 하나 이상이라면, S를 1 감소시키고 임계 구역 진입
            - 임계 구역 앞에서 기다리는 프로세스에 '이제 가도 좋다'고 신호를 주는 signal 함수
                - signal 함수 구현
                    - 임계 구역에서의 작업을 마친 뒤 S를 1 증가<br><br>

    - 세마포의 문제 및 방안
        - 뮤텍스 락과 동일하게 사용할 수 있는 공유 자원이 없는 경우 프로세스는 무작정 무한히 반복하며 S를 확인해야 함
        - 따라서 세마포의 wait 함수에서 만일 사용할 수 있는 자원이 없을 경우 해당 프로세스 상태를 대기 상태로 만들고, 그 프로세스의 PCB를 세마포를 위한 대기 큐에 삽입
        - 다른 프로세스가 임계 구역에서의 작업이 끝나고 signal 함수를 호출
        - signal 함수는 대기 중인 프로세스를 대기 큐에서 제거하고, 프로세스 상태를 준비 상태로 변경한 뒤 준비 큐로 옮김<br><br>

3. 모니터(monitor)
    - 모니터란
        - 세마포에 비해 사용자가 사용하기 편리한 동기화 도구로 조건 변수를 사용
        - 공유 자원과 공유 자원에 접근하기 위한 인터페이스(통로)를 묶어 관리
        - 프로세스는 반드시 인터페이스를 통해서만 공유 자원에 접근
        - 공유 자원에 접근하고자 하는 프로세스를 큐에 삽입하고, 큐에 삽입된 순서대로 하나씩 공유 자원을 이용
            - 공유 자원을 다루는 인터페이스에 접근하기 위한 큐(모니터에 진입하기 위한 큐)를 만들고, 모니터 안에 항상 하나의 프로세스만 들어오도록하여 상호 배제를 위한 동기화를 제공