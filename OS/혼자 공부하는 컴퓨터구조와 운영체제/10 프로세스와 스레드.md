# 10 프로세스와 스레드

## 1. 프로세스 개요
1. 프로세스 직접 확인하기
    - 프로세스(process)란?
        - 실행 중인 프로그램<br><br>

    - 프로그램이 프로세스가 되는 과정
        - 프로그램은 실행되기 전 보조기억장치에 있는 데이터일 뿐
        - 보조기억장치에 저장된 프로그램을 메모리에 적재하고 실행하는 순간 그 프로그램은 프로세스가 됨
        - 위 과정을 '프로세스를 생성한다'라고 표현<br><br>

    - 프로세스 종류
        - 포그라운드 프로세스(forground process) : 사용자가 보는 앞에서 실행되는 프로세스
        - 백그라운드 프로세스(background process) : 사용자가 보지 못하는 뒤편에서 실행되는 프로세스
            - 유닉스 체계의 운영체제에서는 데몬(demon), 윈도우 운영체제에서는 서비스(service)라고 부름
            - 사용자와 직접 상호작용하거나 하지 않고 묵묵히 정해진 일만 수행하는 백그라운드 프로세스가 있음<br><br>

2. 프로세스 제어 블록(PCB, Process Control Block)
    - 프로세스 제어 블록이란?
        - 프로세스와 관련된 정보를 저장하는 자료구조
        - 커널 영역에 생성됨
        - 프로세스 생성 시 만들어지고 실행이 끝나면 폐기됨
        - 운영체제는 PCB를 이용해 빠르게 번갈아 수행되는 프로세스의 실행 순서를 관리하고, 프로세스에 CPU를 비롯한 자원을 배분<br><br>

    - 프로세스 제어 블록에 저장되는 정보
        - 프로세스 ID(PID, Process ID) : 특정 프로세스를 식별하기 위해 부여한느 고유 번호를 저장 
        - 레지스터 값 : 프로세스가 실행하면 사용했던 프로그램 카운터를 
            - 프로세스는 자신의 실행 차례가 오면 이전까지 사용했던 레지스터의 중간값들을 모두 복원시킴
            - 이전까지 진행했던 작업들을 그대로 이어 실행할 수 있기 때문임
        - 프로세스 상태 : 현재 프로세스의 상태 정보를 저장
        - CPU 스케줄링 정보 : 프로세스가 언제, 어떤 순서로 CPU를 할당받을지에 대한 정보를 저장
        - 메모리 관리 정보 : 프로세스의 메모리 주소를 알 수 있는 정보(베이스 레지스터/한계 레지스터 값, 페이지 테이블 등)를 저장
        - 사용한 파일과 입출력장치 정보 : 어떤 입출력장치가 이 프로세스에 할당되었는지, 어떤 파일을 열었는지에 대한 정보를 저장<br><br>

3. 문맥 교환(context switching)
    - 문맥 : 하나의 프로세스 수행을 재개하기 위해 기억해야 할 정보
        - 하나의 프로세스를 실행하던 중 다른 프로세스를 실행해야 하는 경우, 직전에 실행되던 프로세스의 프로그램 카운터, 각종 레지스터 값, 메모리 정보, 실행을 위해 열었던 파일이나 사용한 입출력장치 등의 중간 저보를 백업해야 함<br><br>

    - 문맥 교환 : 기존 프로세스의 문맥을 PCB에 백업하고, 새로운 프로세스를 실행하기 위해 문맥을 PCB로부터 보구하여 새로운 프로세스를 실행하는 것<br><br>

4. 프로세스의 메모리 영역
    - 사용자 영역에서의 프로세스 배치
        - 정적 할당 영역
            - 코드 영역(code segment) = 텍스트 영역(text segment)
                - 실행할 수 있는 코드, 즉 기계어로 이루어진 명령어가 저장
                - 데이터가 아닌 CPU가 실행할 명령어가 담겨 있어 쓰기 금지 → 코드 영역은 읽기 전용(read-only) 공간
            - 데이터 영역(data segment)
                - 프로그램이 실행되는 동안 유지할 데이터가 저장(전역 변수)
            - 프로그램을 구성하는 명령어들이 갑자기 바뀔 일이 없으니 코드 영역의 크가 변할리 없고, 데이터 영역에 저장될 내용은 프로그램이 실행되는 동안에만 유지될 데이터이므로 두 영역을 '크기가 고정된 영역'이라는 점에서 정적 할당 영역이라 부름<br><br>
        - 동적 할당 영역
            - 힙 영역(heap segment)
                - 프로그래머가 직접 할당할 수 있는 저장 공간
                - 힙 영역에 메모리 공간을 할당했다면, 메모리 누수가 발생하지 않도록 해당 공간을 반환해야 함
            - 스택 영역(stack segment)
                - 데이터를 일시적으로 저장(매개변수, 지역 변수)
            - 힙 영역과 스택 영역은 프로세스 실행 과정에서 그 크기가 변할 수 있는 영역<br><br>

## 2. 프로세스 상태와 계층 구조
1. 프로세스 상태
    - 생성 상태(new)
        - 프로세스 생성 중인 상태
        - 메모리에 적재되어 PCB를 할당받은 상태
        - 생성 상태를 거쳐 실행할 준비가 완료된 프로세스는 곧바로 실행되지 않고 준비 상태가 되어 CPY의 할당을 기다림<br><br>

    - 준비 상태(ready)
        - 당장이라도 CPU를 할당받아 실행할 수 있지만, 아직 자신의 차례가 아니기에 기다리고 있는 상태
        - 준비 상태 프로세스는 차례가 되면 CPU를 할당받아 실행 상태가 됨 = 디스패치(dispatch)<br><br>

    - 실행 상태(running)
        - CPU를 할당받아 실행 중인 상태
        - 실행 상태인 프로세스는 할당된 일정 시간 동안만 CPU를 사용할 수 있음
        - 프로세스가 할당된 시간을 모두 사용한다면(타이머 인터럽트 발생) 다시 준비 상태가 되고, 실행 도중 입출력장치를 사용하여 입출력장치의 작업이 끝날 때까지 기다려야 한다면 대기 상태가 됨<br><br>
    
    - 대기 상태(blocked)
        - 입출력장치의 작업을 기다리는 상태
        - 입출력 작업이 완료되면 해당 프로세스는 다시 준비 상태로 CPU 할당을 기다림<br><br>

    - 종료 상태(terminated)
        - 프로세스가 종료된 상태
        - 프로세스가 종료되면 운영체제는 PCB와 프로세스가 사용한 메모리를 정리<br><br>

2. 프로세스 계층 구조
    - 프로세스는 실행 도중 시스템 호출을 통해 다른 프로세스를 생성할 수 있음
        - 부모 프로세스(parent process) : 새 프로세스를 생성한 프로세스
        - 자식 프로세스(child process) : 부모 프로세스에 의해 생성된 프로세스<br><br>

    - 부모 프로세스와 자식 프로세스의 PID
        - 엄연히 다른 프로세스이기에 각기 다른 PID를 가짐
        - 일부 운영체제에서는 자식 프로세스의 PCB에 부모 프로세스의 PID인 PPID(Parent PID)가 기록됨<br><br>

    - 운영체제별 최초의 프로세스
        - 유닉스 운영체제에서의 최초 프로세스 : init
        - 리눅스 운영체제에서의 최초 프로세스 : systemd
        - macOS 운영체제에서의 최초 프로세스 : launchd<br><br>

    - 최초의 프로세스 PID
        - 항상 1번
        - 모든 프로세스 최상단에 있는 부모 프로세스<br><br>

    - 프로세스 간 통신(IPC, Inter-Process Communication)과 공유 메모리(shared memory)
        - 프로세스 간 통신 : 프로세스 간의 자원을 공유하고 데이터를 주고 받는 것
        - 공유 메모리 : 프로셋들이 공유할 수 있는 메모리 영역<br><br>

3. 프로세스 생성 기법
    - 부모 프로세스가 자식 프로세스를 만들고, 자식 프로세스가 자신만의 코드를 실행하는 과정
        - 부모 프로세스가 fork를 통해 자신의 복사본을 자식 프로세스로 생성
        - 만들어진 복사본(자식 프로세스)은 exec를 통해 자신의 메모리 공간을 다른 프로그램으로 교체<br><br>

## 3. 스레드
1. 프로세스와 스레드
    - 스레드란(thread)?
        - 프로세스를 구성하는 실행의 흐름 단위
        - 하나의 프로세스는 여러 개의 스레드를 가질 수 있음<br><br>

    - 단일 스레드 프로세스
        - '실행 흐름 단위가 하나'인 실행되는 프로세스<br><br>

    - 스레드의 구성 요소
        - 프로세스 내에서 각기 다른 스레드 ID, 프로그램 카운터 값을 비롯한 레지스터 값, 스택으로 구성
        - 각자 프로그램 카운터 값을 비롯한 레지스터 값, 스택을 가지고 있어 스레드마다 각기 다른 코드를 실행할 수 있음
        - 프로세스의 스레드들은 실행에 필요한 최소한의 정보만을 유지한 채 프로세스 자원을 공유하며 실행<br><br>

2. 멀티프로세스와 멀터스레드
    - 멀티프로세스(multiporcess) : 여러 프로세스를 동시에 실행하는 것
    - 멀티스레드(multithread) : 여러 스레드로 프로세스를 동시에 실행하는 것<br><br>

3. 동일한 작업을 수행하는 단일 스레드 프로세스 여러 개를 실행하는 것과 하나의 프로세스를 여러 스레드로 실행하는 것의 차이
    - 프로세스끼리는 자원을 굥유하지 않지만, 스레드끼리는 자원을 공유
        - 단일 스레드 프로세스를 여러 개 실행하면 메모리가 낭비되는 반면에 하나의 프로세스를 여러 스레드로 실행하면, 메모리를 더 효율적으로 사용할 수 있음
    - 멀티프로세스 환경에서는 하나의 프로세스에 문제가 생겨도 다른 프로세스에는 지장이 없지만, 멀티스레드 환경에서는 프로세스 전체에 문제가 생길 수 있음