# 15 파일시스템

## 1. 파일과 디렉터리
1. 파일(file)
    - 파일이란
        - 하드 디스크나 SSD와 같은 보조기억장치에 저장된 관련 정보의 집합
        - 의미 있고 관련 있는 정보를 모은 논리적 단위<br><br>

    - 파일을 이루는 정보
        - 파일 이름과 파일을 실행하기 위한 정보, 그리고 파일 관련 부가 정보
            - 부가 정보 : 속성(attribute) 또는 메타데이터(metadata)라고 부르며, 임의의 파일에서 마우스 오른쪽 버튼 클릭 시 나타나는 파일과 관련된 다양한 정보<br><br>

2. 디렉터리(directory)
    - 디렉터리란
        - 파일들을 일목요연하게 관리하기 위해 이용(윈도우 운영체제에서의 디렉터리 = 폴더)<br><br>

    - 디렉터리 구조
        - 1단계 디렉터리(single-level directory)
            - 모든 파일이 하나의 디렉터리 아래에 있는 구조
        - 트리 구조 디렉터리(tree-structured directory)
            - 최상위 디렉터리가 있고 그 아래에 여러 서브 디렉터리가 있는 구조
                - 최상위 디렉터리 : 루트 디렉터리(root directory)라고 부르며, '/(디렉터리 사이의 구분자로도 사용)'로 표현<br><br>

    - 경로(path)
        - 디렉터리를 이용해 파일 위치, 나아가 파일 이름을 특정 짓는 정보
        - 경로를 나타내는 방식
            - 절대 경로(absolute path) : 루트 디렉터리부터 시작하는 경로
            - 상대 경로(relative path) : 현재 디렉터리부터 시작하는 경로<br><br>

    - 디렉터리 엔트리(행)
        - 디렉터리도 파일이며, 단지 포함된 정보가 조금 특별할 뿐
        - 파일이 내부에 해당 파일과 관련된 정보를 담고 있다면, 디렉터리는 내부에 해당 디렉터리에 담겨 있는 대상과 관련된 정보가 담겨 있음
            - 디렉터리에 담긴 정보 : 보조기억장치에 테이블(표) 형태의 정보로 저장
            - 공통으로 포함하는 정보 : 디렉터리에 포함된 대상의 이름과 그 대상이 보조기억장치 내에 저장된 위치를 유추할 수 있는 정보<br><br>

## 2. 파일 시스템
1. 파티셔닝과 포매팅
    - 파티셔닝(partitioning)
        - 파티셔닝이란
            - 하드 디스크나 SSD처럼 용량이 큰 저장 장치를 하나 이상의 논리적인 단위로 구획하는 것<br><br>

        - 파티션(partition)
            - 파티셔닝 작업을 통해 나누어진 영역 하나하나<br><br>

    - 포매팅(formating)
        - 포매팅이란
            - 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지를 결정하고, 새로운 데이터를 쓸 준비를 하는 작업<br><br>

        - 포매팅 종류
            - 저수준 포매팅 : 저장 장치를 생성할 당시 공장에서 수행되는 물리적인 포매팅
            - 논리적 포매팅 : 파일 시스템을 생성하는 포매팅<br><br>

    - 파일 시스템
        - 파일 시스템이란
            - 파일과 디렉터리를 보조기억장치에 일목요연하게 저장하고 접근할 수 있게 하는 운영체제 내부 프로그램
            - 여러 종류가 있고, 파티션마다 다른 파일 시스템을 설정할 수도 있음
            - 포매팅까지 완료하여 파일 시스템을 설정했다면 파일과 디렉터리를 생성할 수 있음<br><br>

2. 파일 할당 방법
    - 연속 할당(contiguous allocation)
        - 보조기억장치 내 연속적인 블록에 파일을 할당하는 방식
        - 연속으로 할당된 파일에 접근하기 위해서는 파일의 첫 번째 블록 주소와 블록 단위의 길이만 알면 됨
        - 구현이 단순하지만, 외부 단편화를 야기하는 문제가 있음<br><br>

    - 불연속 할당(noncontiguous allocation)
        - 연결 할당(linked allocation)
            - 연속 할당의 외부 단편화 문제를 해결할 수 있는 방식
            - 각 블록 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 할당하는 방식
            - 연결 할당의 단점
                - 반드시 첫 번째 블록부터 하나씩 차례대로 읽어야 함
                    - 파일 내 임의의 위치에 접근하는 속도, 즉 임의 접근 속도가 매우 느림
                - 하드웨어 고장이나 오류 발생 시 해당 블록 이후 블록은 접근할 수 없음
                    - 하나의 블록 안에 파일 데이터와 다음 블록 주소가 모두 포함되어 있다 보니, 블록에 하나라도 문제가 생기면 그 블록 이후의 블록에 접근할 수 없음<br><br>

        - 색인 할당(indexed allocation)
            - 파일의 모든 블록 주소를 색인 블록이라는 하나의 블록에 모아 관리하는 방식
            - 파일 내 임의의 위치에 접근<br><br>

3. 파일 시스템 종류
    - FAT 파일 시스템
        - FAT 파일 시스템이란
            - FAT를 이용하는 파일 시스템으로 연결 할당의 단점을 보완한 파일 시스템
            - USB 메모리, SD 카드와 같은 저용량 저장 장치용 파일 시스템으로 많이 사용
            - 버전에 따라 FAT12, 16, 32가 있으며, 뒤에 오는 숫자는 블록(윈도우에서는 클러스터라는 용어를 사용)을 표현하는 비트 수<br><br>

        - 파일 할당 테이블(FAT, File Allocation Table)
            - 각 블록에 포함된 다음 블록의 주소들을 한데 모아 관리하는 테이블
            - 파티션의 앞부분에 만들어짐
            - 실행하는 도중 메모리에 캐시될 수 있어 기존 연결 할당보다 다음 블록을 찾는 속도가 매우 빨라지고, 임의 접근에도 유리<br><br>

    - 유닉스 파일 시스템
        - 색인 블록 대신 i-node(index-node)를 이용하는 색인 할당 기반의 파일 시스템
        - 크기가 유한하여 블록을 20개, 30개, 그 이상 차지하는 파일인 경우 i-node 하나만으로 파일의 데이터 블록을 모두 가리킬 수 없음
            - i-node : 파일 속성 정보와 15개의 블록 주소가 저장될 수 있음
                - 유닉스 파일 시스템에는 파일마다 i-node가 있고, 각각 번호가 부여되어 있음
                - 파티션 내 특정 영역에 모여 있음<br><br>

        - 유닉스 파일 시스템의 문제 해결 방법
            - 블록 주소 중 12개에는 직접 블록 주소를 저장
                - i-node가 가리킬 수 있는 15개의 블록 주소 중 처음 12개에는 파일 데이터가 저장된 블록인 직접 블록 주소가 명시
            - '첫째' 내용으로 충분하지 않다면 13번째 주소에 단일 간접 블록 주소를 저장
                - 12개의 블록 주소로 파일의 모든 블록을 가리킬 수 없다면, 13번째 블록 주소에 '파일 데이터를 저장한 블록 주소가 저장된 블록'인 단일 간접 블록 주소를 저장
            - '둘째' 내용으로 충분하지 않다면 14번째 주소에 이중 간접 블록 주소를 저장
                - 13개의 블록 주소로 파일의 모든 블록을 가리킬 수 없다면, 14번째 블록 주소에 단일 간접 블록들의 주소를 저장하는 블록인 이중 간접 블록 주소를 저장
            - '셋째' 내용으로 충분하지 않다면 15번째 주소에 이중 간접 블록 주소를 저장
                - 14개의 블록 주소로 파일의 모든 블록을 가리킬 수 없다면, 15번째 블록 주소에 이중 간접 블록들의 주소를 저장하는 블록인 삼중 간접 블록 주소를 저장<br><br>

    - 저널링 파일 시스템
        - 저널링 기법을 이용하는 파일 시스템
            - 저널링 기법 : 작업 로그를 통해 시스템 크래시가 발생했을 때 빠르게 복구하기 위한 방법
                - 작업 직전 파티션의 로그 영역에 수행하는 작업(변경 사항)에 대한 로그를 남김
                - 로그를 남긴 후 작업 수행
                - 작업이 끝나면 로그 삭제
        - 작업 도중 시스템 크래시가 발생하여 다시 부팅을 해야 한다면 파일 시스템 전체를 검사할 필요 없이 로그 영역에 남긴 로그만 검사하여 복구 가능
        - 마이크로소프트의 NT 파일 시스템, 리눅스의 ext3, ext4 파일 시스템을 포함한 현대 대부분의 파일 시스템을 이러한 저널링 기능을 제공